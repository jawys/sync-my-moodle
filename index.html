<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
</head>

<body>
  <fieldset>
    <legend>Anmeldedaten</legend>
    <input type="text" id="username" placeholder="Benutzername">
    <input type="password" id="password" placeholder="Passwort">
    <button id="save-credentials">Speichern</button>
  </fieldset>

  <p>
    <button id="update-courses">Aktualisiere Kursliste</button>
  </p>

  <fieldset>
    <legend>Kursliste</legend>
    <div id="courses">
      <i>Sobald aktualisiert wurde, werden hier die Kurse angezeigtâ€¦</i>
    </div>
  </fieldset>
</body>

<script>
  // Import the ipc module for the renderer process
  const ipc = require('electron').ipcRenderer

  // Get the UI buttons
  const saveBtn = document.getElementById('save-credentials')
  const coursesBtn = document.getElementById('update-courses')

  // Add EventListeners to the buttons
  saveBtn.addEventListener('click', () => {
    const username = document.getElementById('username').value
    const password = document.getElementById('password').value
    const credentials = {
      username: username,
      password: password
    }
    ipc.send('save-credentials', credentials)
  })
  coursesBtn.addEventListener('click', () => {
    ipc.send('update-courses')
  })

  // Update courses in UI after receiving them
  ipc.on('courses-updated', (event, courses) => {
    console.log('courses:', courses)
    const fieldsetCourses = document.getElementById('courses')
    fieldsetCourses.innerText = ''

    for (const course of courses) {
      const detailsCourse = document.createElement('details')
      const summaryCourse = document.createElement('summary')
      const checkboxCourse = document.createElement('input')
      const spanCourse = document.createElement('span')
      const ddCourse = document.createElement('dd')

      detailsCourse.id = `course-${course.id}`
      checkboxCourse.type = 'checkbox'
      spanCourse.innerText = course.title

      fieldsetCourses.appendChild(detailsCourse)
      detailsCourse.appendChild(summaryCourse)
      summaryCourse.appendChild(checkboxCourse)
      summaryCourse.appendChild(spanCourse)
      detailsCourse.appendChild(ddCourse)

      if (course.resources.length === 0) {
        ddCourse.innerText = '(leer)'
      } else {
        for (const resource of course.resources) {
          const summaryResource = document.createElement('summary')
          const checkboxResource = document.createElement('input')
          const spanResource = document.createElement('span')

          summaryResource.id = `resource-${resource.id}`
          checkboxResource.type = 'checkbox'
          spanResource.innerText = resource.title

          ddCourse.appendChild(summaryResource)
          summaryResource.appendChild(checkboxResource)
          summaryResource.appendChild(spanResource)
        }
      }
    }
  })
</script>

</html>
